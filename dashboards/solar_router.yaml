title: Solar Router
path: solar-router
icon: mdi:water-boiler
type: sections
max_columns: 2
sections:
  # Section 1: Energy Flow Visualization (Built-in, no dependencies)
  - type: grid
    cards:
      - type: custom:solar-router-flow-card
        title: Solar Router
        show_header: true
        animation_speed: 1

  # Section 2: Controls
  - type: grid
    title: Controls
    cards:
      - type: tile
        entity: switch.solar_router_auto_mode
        name: Auto Mode
        icon: mdi:robot
        color: green
        tap_action:
          action: toggle

      - type: tile
        entity: switch.solar_router_offpeak_fallback
        name: Off-Peak Fallback
        icon: mdi:clock-alert
        color: blue
        tap_action:
          action: toggle

      - type: tile
        entity: switch.solar_router_force_heating
        name: Force Heating
        icon: mdi:fire
        color: red
        tap_action:
          action: toggle

  # Section 3: Conditions
  - type: grid
    title: Routing Conditions
    cards:
      - type: tile
        entity: binary_sensor.solar_router_battery_sufficient
        name: Battery OK
        icon: mdi:battery-check
        color: green

      - type: tile
        entity: binary_sensor.solar_router_solar_sufficient
        name: Solar OK
        icon: mdi:solar-power
        color: amber

      - type: tile
        entity: binary_sensor.solar_router_fallback_needed
        name: Fallback Needed
        icon: mdi:alert-circle
        color: orange

      - type: tile
        entity: binary_sensor.solar_router_tank_hot
        name: Tank Warm
        icon: mdi:thermometer-check
        color: red

  # Section 4: Thresholds
  - type: grid
    title: Threshold Settings
    cards:
      - type: tile
        entity: number.solar_router_min_soc_threshold
        name: Min Battery SoC
        icon: mdi:battery-60
        features:
          - type: numeric-input
            mode: slider

      - type: tile
        entity: number.solar_router_min_solar_power_threshold
        name: Min Solar Power
        icon: mdi:solar-power
        features:
          - type: numeric-input
            mode: slider

      - type: tile
        entity: number.solar_router_min_daily_heating_threshold
        name: Min Daily Heating
        icon: mdi:timer
        features:
          - type: numeric-input
            mode: slider

      - type: tile
        entity: number.solar_router_tank_temperature_calibration
        name: Calibrate Temp
        icon: mdi:thermometer-lines
        features:
          - type: numeric-input
            mode: box

  # Section 5: Quick Actions
  - type: grid
    title: Quick Actions
    cards:
      - type: button
        name: Record Shower
        icon: mdi:shower
        tap_action:
          action: call-service
          service: solar_router.apply_usage_event
          data:
            event: shower

      - type: button
        name: Record Dishes
        icon: mdi:silverware-clean
        tap_action:
          action: call-service
          service: solar_router.apply_usage_event
          data:
            event: dishes

      - type: button
        name: Force 1 Hour
        icon: mdi:fire
        tap_action:
          action: call-service
          service: solar_router.force_heating
          data:
            duration: 60

      - type: button
        name: Stop Heating
        icon: mdi:stop
        tap_action:
          action: call-service
          service: solar_router.stop_heating

  # Section 6: Temperature History
  - type: grid
    title: Temperature History
    cards:
      - type: history-graph
        hours_to_show: 24
        entities:
          - entity: sensor.solar_router_tank_temp_estimate
            name: Tank Temperature

  # Section 7: Heating History
  - type: grid
    title: Heating History
    cards:
      - type: history-graph
        hours_to_show: 24
        entities:
          - entity: binary_sensor.solar_router_is_heating
            name: Heating
          - entity: binary_sensor.solar_router_solar_sufficient
            name: Solar OK
          - entity: binary_sensor.solar_router_battery_sufficient
            name: Battery OK
